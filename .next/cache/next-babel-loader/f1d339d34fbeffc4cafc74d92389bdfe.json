{"ast":null,"code":"import connectDB from \"../../utils/connectDB\";\nimport bcrypt from \"bcryptjs\";\nimport User from \"../../models/User\";\nimport isEmail from \"validator/lib/isEmail\";\nimport isLength from \"validator/lib/isLength\";\nimport jwt from \"jsonwebtoken\";\nconnectDB();\nexport default (async (req, res) => {\n  const {\n    name,\n    email,\n    password\n  } = req.body;\n  console.log(name); //Validate user input\n\n  if (isLength(name, {\n    min: 3,\n    max: 10\n  })) {\n    return res.status(422).send(\"Name must be 3 - 10 characters long\");\n  }\n\n  if (isLength(password, {\n    min: 6\n  })) {\n    return res.status(422).send(\"Password must be 6 characters long\");\n  }\n\n  if (isEmail(email)) {\n    return res.status(422).send(\"Email must be valid\");\n  } // check if user is exist in db\n\n\n  const user = await User.findOne({\n    email\n  });\n\n  if (user) {\n    return res.status(422).send(\"Email is already taken\");\n  } //hash user password\n\n\n  const hash = await bcrypt.hashSync(password, 10);\n\n  try {\n    //create new user\n    const newUser = await new User({\n      name,\n      email,\n      password: hash\n    }).save(); //create token for new user\n\n    const token = jwt.sign({\n      userId: newUser._id\n    }, process.env.JWT_SECRET, {\n      expiresIn: \"7d\"\n    }); //send back token to client\n\n    res.status(201).json(token);\n  } catch (error) {\n    console.error(error);\n    res.status(500).send(\"Error in creating in users. Please try again\");\n  }\n});","map":{"version":3,"sources":["/home/russ/projects/dress-shop/pages/api/signup.js"],"names":["connectDB","bcrypt","User","isEmail","isLength","jwt","req","res","name","email","password","body","console","log","min","max","status","send","user","findOne","hash","hashSync","newUser","save","token","sign","userId","_id","process","env","JWT_SECRET","expiresIn","json","error"],"mappings":"AAAA,OAAOA,SAAP,MAAsB,uBAAtB;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,OAAOC,IAAP,MAAiB,mBAAjB;AACA,OAAOC,OAAP,MAAoB,uBAApB;AACA,OAAOC,QAAP,MAAqB,wBAArB;AACA,OAAOC,GAAP,MAAgB,cAAhB;AAEAL,SAAS;AAET,gBAAe,OAAOM,GAAP,EAAYC,GAAZ,KAAoB;AACjC,QAAM;AAAEC,IAAAA,IAAF;AAAQC,IAAAA,KAAR;AAAeC,IAAAA;AAAf,MAA4BJ,GAAG,CAACK,IAAtC;AACAC,EAAAA,OAAO,CAACC,GAAR,CAAYL,IAAZ,EAFiC,CAGjC;;AACA,MAAIJ,QAAQ,CAACI,IAAD,EAAO;AAAEM,IAAAA,GAAG,EAAE,CAAP;AAAUC,IAAAA,GAAG,EAAE;AAAf,GAAP,CAAZ,EAAyC;AACvC,WAAOR,GAAG,CAACS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,qCAArB,CAAP;AACD;;AACD,MAAIb,QAAQ,CAACM,QAAD,EAAW;AAAEI,IAAAA,GAAG,EAAE;AAAP,GAAX,CAAZ,EAAoC;AAClC,WAAOP,GAAG,CAACS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,oCAArB,CAAP;AACD;;AACD,MAAId,OAAO,CAACM,KAAD,CAAX,EAAoB;AAClB,WAAOF,GAAG,CAACS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,qBAArB,CAAP;AACD,GAZgC,CAajC;;;AACA,QAAMC,IAAI,GAAG,MAAMhB,IAAI,CAACiB,OAAL,CAAa;AAAEV,IAAAA;AAAF,GAAb,CAAnB;;AACA,MAAIS,IAAJ,EAAU;AACR,WAAOX,GAAG,CAACS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,wBAArB,CAAP;AACD,GAjBgC,CAkBjC;;;AACA,QAAMG,IAAI,GAAG,MAAMnB,MAAM,CAACoB,QAAP,CAAgBX,QAAhB,EAA0B,EAA1B,CAAnB;;AACA,MAAI;AACF;AACA,UAAMY,OAAO,GAAG,MAAM,IAAIpB,IAAJ,CAAS;AAAEM,MAAAA,IAAF;AAAQC,MAAAA,KAAR;AAAeC,MAAAA,QAAQ,EAAEU;AAAzB,KAAT,EAA0CG,IAA1C,EAAtB,CAFE,CAGF;;AACA,UAAMC,KAAK,GAAGnB,GAAG,CAACoB,IAAJ,CAAS;AAAEC,MAAAA,MAAM,EAAEJ,OAAO,CAACK;AAAlB,KAAT,EAAkCC,OAAO,CAACC,GAAR,CAAYC,UAA9C,EAA0D;AACtEC,MAAAA,SAAS,EAAE;AAD2D,KAA1D,CAAd,CAJE,CAOF;;AACAxB,IAAAA,GAAG,CAACS,MAAJ,CAAW,GAAX,EAAgBgB,IAAhB,CAAqBR,KAArB;AACD,GATD,CASE,OAAOS,KAAP,EAAc;AACdrB,IAAAA,OAAO,CAACqB,KAAR,CAAcA,KAAd;AACA1B,IAAAA,GAAG,CAACS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,8CAArB;AACD;AACF,CAjCD","sourcesContent":["import connectDB from \"../../utils/connectDB\";\nimport bcrypt from \"bcryptjs\";\nimport User from \"../../models/User\";\nimport isEmail from \"validator/lib/isEmail\";\nimport isLength from \"validator/lib/isLength\";\nimport jwt from \"jsonwebtoken\";\n\nconnectDB();\n\nexport default async (req, res) => {\n  const { name, email, password } = req.body;\n  console.log(name);\n  //Validate user input\n  if (isLength(name, { min: 3, max: 10 })) {\n    return res.status(422).send(\"Name must be 3 - 10 characters long\");\n  }\n  if (isLength(password, { min: 6 })) {\n    return res.status(422).send(\"Password must be 6 characters long\");\n  }\n  if (isEmail(email)) {\n    return res.status(422).send(\"Email must be valid\");\n  }\n  // check if user is exist in db\n  const user = await User.findOne({ email });\n  if (user) {\n    return res.status(422).send(\"Email is already taken\");\n  }\n  //hash user password\n  const hash = await bcrypt.hashSync(password, 10);\n  try {\n    //create new user\n    const newUser = await new User({ name, email, password: hash }).save();\n    //create token for new user\n    const token = jwt.sign({ userId: newUser._id }, process.env.JWT_SECRET, {\n      expiresIn: \"7d\"\n    });\n    //send back token to client\n    res.status(201).json(token);\n  } catch (error) {\n    console.error(error);\n    res.status(500).send(\"Error in creating in users. Please try again\");\n  }\n};\n"]},"metadata":{},"sourceType":"module"}