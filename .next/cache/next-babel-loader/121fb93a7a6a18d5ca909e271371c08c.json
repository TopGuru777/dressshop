{"ast":null,"code":"import _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport aws from 'aws-sdk';\nimport multer from 'multer';\nimport multerS3 from 'multer-s3';\nimport uuid from 'uuid/v4';\nconst s3 = new aws.S3({\n  accessKeyId: 'AKIAIW2XE7PTZLQQZIJQ',\n  secretAccessKey: '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'\n});\nconst upload = multer({\n  storage: multerS3({\n    s3: s3,\n    bucket: 'dress-shop',\n    metadata: function (req, file, cb) {\n      console.log(file);\n      cb(null, {\n        fieldName: file.fieldname\n      });\n    },\n    key: function (req, file, cb) {\n      cb(null, req.s3Key);\n    }\n  })\n});\nconst singleFileUpload = upload.single('image');\n\nconst uploadToS3 = (req, res) => {\n  req.s3Key = uuid();\n  const imageURL = `https://dress-shop.s3-ap-southeast-1.amazonaws.com/${req.s3Key}`;\n  return new _Promise((resolve, reject) => {\n    return singleFileUpload(req, res, err => {\n      if (err) reject(err);\n      return resolve(imageURL);\n    });\n  });\n};\n\nexport default (async (req, res) => {\n  uploadToS3(req, res).then(res => console.log(res)).catch(err => console.log(err));\n  res.send('test');\n});","map":{"version":3,"sources":["/home/russ/projects/dress-shop/pages/api/upload.js"],"names":["aws","multer","multerS3","uuid","s3","S3","accessKeyId","secretAccessKey","upload","storage","bucket","metadata","req","file","cb","console","log","fieldName","fieldname","key","s3Key","singleFileUpload","single","uploadToS3","res","imageURL","resolve","reject","err","then","catch","send"],"mappings":";AAAA,OAAOA,GAAP,MAAgB,SAAhB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAOC,QAAP,MAAqB,WAArB;AACA,OAAOC,IAAP,MAAiB,SAAjB;AAEA,MAAMC,EAAE,GAAG,IAAIJ,GAAG,CAACK,EAAR,CAAW;AACpBC,EAAAA,WAAW,EAAE,sBADO;AAEpBC,EAAAA,eAAe,EAAE;AAFG,CAAX,CAAX;AAKA,MAAMC,MAAM,GAAGP,MAAM,CAAC;AACpBQ,EAAAA,OAAO,EAAEP,QAAQ,CAAC;AAChBE,IAAAA,EAAE,EAAEA,EADY;AAEhBM,IAAAA,MAAM,EAAE,YAFQ;AAGhBC,IAAAA,QAAQ,EAAE,UAASC,GAAT,EAAcC,IAAd,EAAoBC,EAApB,EAAwB;AAChCC,MAAAA,OAAO,CAACC,GAAR,CAAYH,IAAZ;AACAC,MAAAA,EAAE,CAAC,IAAD,EAAO;AAAEG,QAAAA,SAAS,EAAEJ,IAAI,CAACK;AAAlB,OAAP,CAAF;AACD,KANe;AAOhBC,IAAAA,GAAG,EAAE,UAASP,GAAT,EAAcC,IAAd,EAAoBC,EAApB,EAAwB;AAC3BA,MAAAA,EAAE,CAAC,IAAD,EAAOF,GAAG,CAACQ,KAAX,CAAF;AACD;AATe,GAAD;AADG,CAAD,CAArB;AAcA,MAAMC,gBAAgB,GAAGb,MAAM,CAACc,MAAP,CAAc,OAAd,CAAzB;;AAEA,MAAMC,UAAU,GAAG,CAACX,GAAD,EAAMY,GAAN,KAAc;AAC/BZ,EAAAA,GAAG,CAACQ,KAAJ,GAAYjB,IAAI,EAAhB;AACA,QAAMsB,QAAQ,GAAI,sDAAqDb,GAAG,CAACQ,KAAM,EAAjF;AACA,SAAO,aAAY,CAACM,OAAD,EAAUC,MAAV,KAAqB;AACtC,WAAON,gBAAgB,CAACT,GAAD,EAAMY,GAAN,EAAWI,GAAG,IAAI;AACvC,UAAIA,GAAJ,EAASD,MAAM,CAACC,GAAD,CAAN;AACT,aAAOF,OAAO,CAACD,QAAD,CAAd;AACD,KAHsB,CAAvB;AAID,GALM,CAAP;AAMD,CATD;;AAWA,gBAAe,OAAOb,GAAP,EAAYY,GAAZ,KAAoB;AACjCD,EAAAA,UAAU,CAACX,GAAD,EAAMY,GAAN,CAAV,CACGK,IADH,CACQL,GAAG,IAAIT,OAAO,CAACC,GAAR,CAAYQ,GAAZ,CADf,EAEGM,KAFH,CAESF,GAAG,IAAIb,OAAO,CAACC,GAAR,CAAYY,GAAZ,CAFhB;AAGAJ,EAAAA,GAAG,CAACO,IAAJ,CAAS,MAAT;AACD,CALD","sourcesContent":["import aws from 'aws-sdk';\nimport multer from 'multer';\nimport multerS3 from 'multer-s3';\nimport uuid from 'uuid/v4';\n\nconst s3 = new aws.S3({\n  accessKeyId: 'AKIAIW2XE7PTZLQQZIJQ',\n  secretAccessKey: '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'\n});\n\nconst upload = multer({\n  storage: multerS3({\n    s3: s3,\n    bucket: 'dress-shop',\n    metadata: function(req, file, cb) {\n      console.log(file);\n      cb(null, { fieldName: file.fieldname });\n    },\n    key: function(req, file, cb) {\n      cb(null, req.s3Key);\n    }\n  })\n});\n\nconst singleFileUpload = upload.single('image');\n\nconst uploadToS3 = (req, res) => {\n  req.s3Key = uuid();\n  const imageURL = `https://dress-shop.s3-ap-southeast-1.amazonaws.com/${req.s3Key}`;\n  return new Promise((resolve, reject) => {\n    return singleFileUpload(req, res, err => {\n      if (err) reject(err);\n      return resolve(imageURL);\n    });\n  });\n};\n\nexport default async (req, res) => {\n  uploadToS3(req, res)\n    .then(res => console.log(res))\n    .catch(err => console.log(err));\n  res.send('test');\n};\n"]},"metadata":{},"sourceType":"module"}