{"ast":null,"code":"import connectDB from '../../utils/connectDB';\nimport Product from '../../models/Product';\nexport default (async (req, res) => {\n  await connectDB();\n\n  try {\n    let {\n      category,\n      price,\n      keyword\n    } = req.query;\n    let sort;\n    let products = [];\n\n    if (price) {\n      sort = price === 'low' ? {\n        price: 1\n      } : {\n        price: -1\n      };\n    } else {\n      sort = {\n        _id: 'desc'\n      };\n    }\n\n    if (keyword) {\n      products = await Product.find({\n        $text: {\n          $search: keyword\n        }\n      }).sort(sort);\n    } else if (category) {\n      products = await Product.find({\n        category\n      }).sort(sort);\n    }\n\n    res.status(200).json({\n      products\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).send('Error in getting categories');\n  }\n});","map":{"version":3,"sources":["/home/russ/projects/dress-shop/pages/api/search.js"],"names":["connectDB","Product","req","res","category","price","keyword","query","sort","products","_id","find","$text","$search","status","json","error","console","send"],"mappings":"AAAA,OAAOA,SAAP,MAAsB,uBAAtB;AACA,OAAOC,OAAP,MAAoB,sBAApB;AAEA,gBAAe,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AACjC,QAAMH,SAAS,EAAf;;AACA,MAAI;AACF,QAAI;AAAEI,MAAAA,QAAF;AAAYC,MAAAA,KAAZ;AAAmBC,MAAAA;AAAnB,QAA+BJ,GAAG,CAACK,KAAvC;AACA,QAAIC,IAAJ;AACA,QAAIC,QAAQ,GAAG,EAAf;;AAEA,QAAIJ,KAAJ,EAAW;AACTG,MAAAA,IAAI,GAAGH,KAAK,KAAK,KAAV,GAAkB;AAAEA,QAAAA,KAAK,EAAE;AAAT,OAAlB,GAAiC;AAAEA,QAAAA,KAAK,EAAE,CAAC;AAAV,OAAxC;AACD,KAFD,MAEO;AACLG,MAAAA,IAAI,GAAG;AAAEE,QAAAA,GAAG,EAAE;AAAP,OAAP;AACD;;AAED,QAAIJ,OAAJ,EAAa;AACXG,MAAAA,QAAQ,GAAG,MAAMR,OAAO,CAACU,IAAR,CAAa;AAAEC,QAAAA,KAAK,EAAE;AAAEC,UAAAA,OAAO,EAAEP;AAAX;AAAT,OAAb,EAA8CE,IAA9C,CAAmDA,IAAnD,CAAjB;AACD,KAFD,MAEO,IAAIJ,QAAJ,EAAc;AACnBK,MAAAA,QAAQ,GAAG,MAAMR,OAAO,CAACU,IAAR,CAAa;AAAEP,QAAAA;AAAF,OAAb,EAA2BI,IAA3B,CAAgCA,IAAhC,CAAjB;AACD;;AAEDL,IAAAA,GAAG,CAACW,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEN,MAAAA;AAAF,KAArB;AACD,GAlBD,CAkBE,OAAOO,KAAP,EAAc;AACdC,IAAAA,OAAO,CAACD,KAAR,CAAcA,KAAd;AACAb,IAAAA,GAAG,CAACW,MAAJ,CAAW,GAAX,EAAgBI,IAAhB,CAAqB,6BAArB;AACD;AACF,CAxBD","sourcesContent":["import connectDB from '../../utils/connectDB';\nimport Product from '../../models/Product';\n\nexport default async (req, res) => {\n  await connectDB();\n  try {\n    let { category, price, keyword } = req.query;\n    let sort;\n    let products = [];\n\n    if (price) {\n      sort = price === 'low' ? { price: 1 } : { price: -1 };\n    } else {\n      sort = { _id: 'desc' };\n    }\n\n    if (keyword) {\n      products = await Product.find({ $text: { $search: keyword } }).sort(sort);\n    } else if (category) {\n      products = await Product.find({ category }).sort(sort);\n    }\n\n    res.status(200).json({ products });\n  } catch (error) {\n    console.error(error);\n    res.status(500).send('Error in getting categories');\n  }\n};\n"]},"metadata":{},"sourceType":"module"}