{"ast":null,"code":"import connectDB from \"../../utils/connectDB\";\nimport Cart from \"../../models/Cart\";\nimport jwt from \"jsonwebtoken\";\nconnectDB();\nexport default (async (req, res) => {\n  switch (req.method) {\n    case \"GET\":\n      await handleGetRequest(req, res);\n      break;\n\n    case \"POST\":\n      await handlePostRequest(req, res);\n      break;\n\n    default:\n      res.status(422).send(\"Unknown method\");\n  }\n});\n\nasync function handleGetRequest(req, res) {\n  if (!req.headers.authorization) {\n    return res.status(401).send(\"No authorization token\");\n  }\n\n  try {\n    const {\n      userId\n    } = jwt.verify(req.headers.authorization, process.env.JWT_SECRET);\n    const cart = await Cart.findOne({\n      user: userId\n    });\n    console.log(cart);\n    res.send(\"test\");\n  } catch (error) {\n    console.error(error);\n    res.status(500).send(\"Error in fetching cart\");\n  }\n}\n\nasync function handlePostRequest(req, res) {\n  const {\n    productId,\n    quantity\n  } = req.body;\n\n  if (!req.headers.authorization) {\n    return res.status(401).send(\"No authorization token\");\n  }\n\n  try {\n    const {\n      userId\n    } = jwt.verify(req.headers.authorization, process.env.JWT_SECRET);\n    const cart = await Cart.findOne({\n      user: userId\n    }); //   const cart = await new Cart({\n    //     user: userId,\n    //     carts: [{ quantity, product: productId }]\n    //   }).save();\n\n    console.log(cart);\n    res.send(\"test\");\n  } catch (error) {\n    console.error(error);\n    res.status(500).send(\"Error in adding cart\");\n  }\n}","map":{"version":3,"sources":["/home/russ/projects/dress-shop/pages/api/cart.js"],"names":["connectDB","Cart","jwt","req","res","method","handleGetRequest","handlePostRequest","status","send","headers","authorization","userId","verify","process","env","JWT_SECRET","cart","findOne","user","console","log","error","productId","quantity","body"],"mappings":"AAAA,OAAOA,SAAP,MAAsB,uBAAtB;AACA,OAAOC,IAAP,MAAiB,mBAAjB;AACA,OAAOC,GAAP,MAAgB,cAAhB;AAEAF,SAAS;AAET,gBAAe,OAAOG,GAAP,EAAYC,GAAZ,KAAoB;AACjC,UAAQD,GAAG,CAACE,MAAZ;AACE,SAAK,KAAL;AACE,YAAMC,gBAAgB,CAACH,GAAD,EAAMC,GAAN,CAAtB;AACA;;AACF,SAAK,MAAL;AACE,YAAMG,iBAAiB,CAACJ,GAAD,EAAMC,GAAN,CAAvB;AACA;;AACF;AACEA,MAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,gBAArB;AARJ;AAUD,CAXD;;AAaA,eAAeH,gBAAf,CAAgCH,GAAhC,EAAqCC,GAArC,EAA0C;AACxC,MAAI,CAACD,GAAG,CAACO,OAAJ,CAAYC,aAAjB,EAAgC;AAC9B,WAAOP,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,wBAArB,CAAP;AACD;;AACD,MAAI;AACF,UAAM;AAAEG,MAAAA;AAAF,QAAaV,GAAG,CAACW,MAAJ,CACjBV,GAAG,CAACO,OAAJ,CAAYC,aADK,EAEjBG,OAAO,CAACC,GAAR,CAAYC,UAFK,CAAnB;AAIA,UAAMC,IAAI,GAAG,MAAMhB,IAAI,CAACiB,OAAL,CAAa;AAAEC,MAAAA,IAAI,EAAEP;AAAR,KAAb,CAAnB;AACAQ,IAAAA,OAAO,CAACC,GAAR,CAAYJ,IAAZ;AACAb,IAAAA,GAAG,CAACK,IAAJ,CAAS,MAAT;AACD,GARD,CAQE,OAAOa,KAAP,EAAc;AACdF,IAAAA,OAAO,CAACE,KAAR,CAAcA,KAAd;AACAlB,IAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,wBAArB;AACD;AACF;;AAED,eAAeF,iBAAf,CAAiCJ,GAAjC,EAAsCC,GAAtC,EAA2C;AACzC,QAAM;AAAEmB,IAAAA,SAAF;AAAaC,IAAAA;AAAb,MAA0BrB,GAAG,CAACsB,IAApC;;AACA,MAAI,CAACtB,GAAG,CAACO,OAAJ,CAAYC,aAAjB,EAAgC;AAC9B,WAAOP,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,wBAArB,CAAP;AACD;;AACD,MAAI;AACF,UAAM;AAAEG,MAAAA;AAAF,QAAaV,GAAG,CAACW,MAAJ,CACjBV,GAAG,CAACO,OAAJ,CAAYC,aADK,EAEjBG,OAAO,CAACC,GAAR,CAAYC,UAFK,CAAnB;AAIA,UAAMC,IAAI,GAAG,MAAMhB,IAAI,CAACiB,OAAL,CAAa;AAAEC,MAAAA,IAAI,EAAEP;AAAR,KAAb,CAAnB,CALE,CAMF;AACA;AACA;AACA;;AACAQ,IAAAA,OAAO,CAACC,GAAR,CAAYJ,IAAZ;AACAb,IAAAA,GAAG,CAACK,IAAJ,CAAS,MAAT;AACD,GAZD,CAYE,OAAOa,KAAP,EAAc;AACdF,IAAAA,OAAO,CAACE,KAAR,CAAcA,KAAd;AACAlB,IAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,sBAArB;AACD;AACF","sourcesContent":["import connectDB from \"../../utils/connectDB\";\nimport Cart from \"../../models/Cart\";\nimport jwt from \"jsonwebtoken\";\n\nconnectDB();\n\nexport default async (req, res) => {\n  switch (req.method) {\n    case \"GET\":\n      await handleGetRequest(req, res);\n      break;\n    case \"POST\":\n      await handlePostRequest(req, res);\n      break;\n    default:\n      res.status(422).send(\"Unknown method\");\n  }\n};\n\nasync function handleGetRequest(req, res) {\n  if (!req.headers.authorization) {\n    return res.status(401).send(\"No authorization token\");\n  }\n  try {\n    const { userId } = jwt.verify(\n      req.headers.authorization,\n      process.env.JWT_SECRET\n    );\n    const cart = await Cart.findOne({ user: userId });\n    console.log(cart);\n    res.send(\"test\");\n  } catch (error) {\n    console.error(error);\n    res.status(500).send(\"Error in fetching cart\");\n  }\n}\n\nasync function handlePostRequest(req, res) {\n  const { productId, quantity } = req.body;\n  if (!req.headers.authorization) {\n    return res.status(401).send(\"No authorization token\");\n  }\n  try {\n    const { userId } = jwt.verify(\n      req.headers.authorization,\n      process.env.JWT_SECRET\n    );\n    const cart = await Cart.findOne({ user: userId });\n    //   const cart = await new Cart({\n    //     user: userId,\n    //     carts: [{ quantity, product: productId }]\n    //   }).save();\n    console.log(cart);\n    res.send(\"test\");\n  } catch (error) {\n    console.error(error);\n    res.status(500).send(\"Error in adding cart\");\n  }\n}\n"]},"metadata":{},"sourceType":"module"}