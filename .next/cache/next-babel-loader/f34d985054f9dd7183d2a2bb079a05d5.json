{"ast":null,"code":"import aws from 'aws-sdk';\nimport multer from 'multer';\nimport multerS3 from 'multer-s3';\nimport uuid from 'uuid/v4';\nimport uploadImage from '../../middlewares/upload-image';\nconst s3 = new aws.S3({\n  accessKeyId: 'AKIAIW2XE7PTZLQQZIJQ',\n  secretAccessKey: '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',\n  region: 'ap-southeast-1'\n});\nconst upload = multer({\n  storage: multerS3({\n    s3: s3,\n    acl: 'public-read',\n    bucket: 'dress-shop',\n    metadata: function (req, file, cb) {\n      console.log(file);\n      cb(null, {\n        fieldName: file.fieldname\n      });\n    },\n    key: function (req, file, cb) {\n      cb(null, req.s3Key);\n    }\n  })\n});\nconst singleFileUpload = upload.single('image');\n\nconst handle = async (req, res) => {\n  const file = req.upload(req, res);\n  console.log(file);\n  res.send('test'); //   var params = {\n  //     Bucket: 'dress-shop',\n  //     Key: file.originalname,\n  //     Body: file.buffer,\n  //     ContentType: file.mimetype,\n  //     ACL: 'public-read'\n  //   };\n  //   s3.upload(params, function(err, data) {\n  //     if (err) {\n  //       res.status(500).json({ error: true, Message: err });\n  //     } else {\n  //       res.send({ data });\n  //     }\n  //   });\n};\n\nexport default uploadImage(handle);","map":{"version":3,"sources":["/home/russ/projects/dress-shop/pages/api/upload.js"],"names":["aws","multer","multerS3","uuid","uploadImage","s3","S3","accessKeyId","secretAccessKey","region","upload","storage","acl","bucket","metadata","req","file","cb","console","log","fieldName","fieldname","key","s3Key","singleFileUpload","single","handle","res","send"],"mappings":"AAAA,OAAOA,GAAP,MAAgB,SAAhB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAOC,QAAP,MAAqB,WAArB;AACA,OAAOC,IAAP,MAAiB,SAAjB;AACA,OAAOC,WAAP,MAAwB,gCAAxB;AAEA,MAAMC,EAAE,GAAG,IAAIL,GAAG,CAACM,EAAR,CAAW;AACpBC,EAAAA,WAAW,EAAE,sBADO;AAEpBC,EAAAA,eAAe,EAAE,0CAFG;AAGpBC,EAAAA,MAAM,EAAE;AAHY,CAAX,CAAX;AAMA,MAAMC,MAAM,GAAGT,MAAM,CAAC;AACpBU,EAAAA,OAAO,EAAET,QAAQ,CAAC;AAChBG,IAAAA,EAAE,EAAEA,EADY;AAEhBO,IAAAA,GAAG,EAAE,aAFW;AAGhBC,IAAAA,MAAM,EAAE,YAHQ;AAIhBC,IAAAA,QAAQ,EAAE,UAASC,GAAT,EAAcC,IAAd,EAAoBC,EAApB,EAAwB;AAChCC,MAAAA,OAAO,CAACC,GAAR,CAAYH,IAAZ;AACAC,MAAAA,EAAE,CAAC,IAAD,EAAO;AAAEG,QAAAA,SAAS,EAAEJ,IAAI,CAACK;AAAlB,OAAP,CAAF;AACD,KAPe;AAQhBC,IAAAA,GAAG,EAAE,UAASP,GAAT,EAAcC,IAAd,EAAoBC,EAApB,EAAwB;AAC3BA,MAAAA,EAAE,CAAC,IAAD,EAAOF,GAAG,CAACQ,KAAX,CAAF;AACD;AAVe,GAAD;AADG,CAAD,CAArB;AAeA,MAAMC,gBAAgB,GAAGd,MAAM,CAACe,MAAP,CAAc,OAAd,CAAzB;;AAEA,MAAMC,MAAM,GAAG,OAAOX,GAAP,EAAYY,GAAZ,KAAoB;AACjC,QAAMX,IAAI,GAAGD,GAAG,CAACL,MAAJ,CAAWK,GAAX,EAAgBY,GAAhB,CAAb;AACAT,EAAAA,OAAO,CAACC,GAAR,CAAYH,IAAZ;AAEAW,EAAAA,GAAG,CAACC,IAAJ,CAAS,MAAT,EAJiC,CAKjC;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACD,CApBD;;AAsBA,eAAexB,WAAW,CAACsB,MAAD,CAA1B","sourcesContent":["import aws from 'aws-sdk';\nimport multer from 'multer';\nimport multerS3 from 'multer-s3';\nimport uuid from 'uuid/v4';\nimport uploadImage from '../../middlewares/upload-image';\n\nconst s3 = new aws.S3({\n  accessKeyId: 'AKIAIW2XE7PTZLQQZIJQ',\n  secretAccessKey: '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',\n  region: 'ap-southeast-1'\n});\n\nconst upload = multer({\n  storage: multerS3({\n    s3: s3,\n    acl: 'public-read',\n    bucket: 'dress-shop',\n    metadata: function(req, file, cb) {\n      console.log(file);\n      cb(null, { fieldName: file.fieldname });\n    },\n    key: function(req, file, cb) {\n      cb(null, req.s3Key);\n    }\n  })\n});\n\nconst singleFileUpload = upload.single('image');\n\nconst handle = async (req, res) => {\n  const file = req.upload(req, res);\n  console.log(file);\n\n  res.send('test');\n  //   var params = {\n  //     Bucket: 'dress-shop',\n  //     Key: file.originalname,\n  //     Body: file.buffer,\n  //     ContentType: file.mimetype,\n  //     ACL: 'public-read'\n  //   };\n\n  //   s3.upload(params, function(err, data) {\n  //     if (err) {\n  //       res.status(500).json({ error: true, Message: err });\n  //     } else {\n  //       res.send({ data });\n  //     }\n  //   });\n};\n\nexport default uploadImage(handle);\n"]},"metadata":{},"sourceType":"module"}